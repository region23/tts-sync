# TTS Synchronization Research

## Техники синхронизации TTS с видео и субтитрами

### AWS Polly Subtitle Generator

AWS Polly Subtitle Generator предоставляет эффективный метод для одновременной генерации аудио и субтитров для заданного текста. Ключевые особенности:

- Генерирует синхронизированные аудио и субтитры из текстового ввода
- Поддерживает несколько аудио форматов (PCM/WAV, OGG, MP3)
- Поддерживает форматы субтитров VTT и SRT
- Использует Amazon Polly для генерации речи
- Автоматически синхронизирует тайминги субтитров с аудио

Пример использования:
```python
from polly_vtt import PollyVTT

polly_vtt = PollyVTT()

polly_vtt.generate(
    "output_file",
    Text="Текст для озвучивания",
    VoiceId="Joanna",
    OutputFormat="mp3",
)
```

Этот подход хорошо работает для создания синхронизированных субтитров и аудио, но требует использования AWS Polly и не предоставляет прямого контроля над синхронизацией для существующих видео.

### Подход с использованием SpeakProgress события

На Stack Overflow был найден подход для синхронизации субтитров с TTS с использованием события SpeakProgress:

```csharp
void synth_SpeakProgress(object sender, SpeakProgressEventArgs e)
{
    curAuidoPosition = e.AudioPosition;
    using (Graphics g = Graphics.FromImage(Screen))
    {
         g.DrawString(e.Text,...); 
    }                    
    VideoWriter.WriteVideoFrame(Screen, curAuidoPosition);
}
```

Этот подход позволяет отслеживать прогресс озвучивания и синхронизировать его с видео, но имеет проблемы с точностью для некоторых голосов. Проблема в том, что `e.AudioPosition` может быть неточным, и требуется дополнительная настройка аудио формата.

## Аудио библиотеки для Rust

### Библиотеки для обработки аудио

1. **rubato** - Асинхронная библиотека для ресемплинга, предназначенная для аудио данных
   - Поддерживает изменение темпа аудио
   - Хорошо подходит для реального времени
   - Может использоваться для подстройки длительности аудио под видео

2. **symphonia** - Чистая Rust библиотека для декодирования медиа контейнеров и аудио
   - Поддерживает различные аудио форматы
   - Может использоваться для работы с аудио файлами

3. **cpal** - Низкоуровневая кросс-платформенная библиотека для ввода/вывода аудио
   - Может использоваться для воспроизведения и записи аудио

4. **hound** - Библиотека для кодирования и декодирования WAV файлов
   - Может использоваться для работы с WAV файлами

5. **rodio** - Библиотека для воспроизведения аудио
   - Простой интерфейс для воспроизведения аудио

### Библиотеки для анализа аудио

1. **ridgeline** - Библиотека для анализа частотного спектра потоковых сигналов
   - Позволяет анализировать частотный спектр аудио
   - Может использоваться для определения характеристик аудио

2. **web-audio-api** - Реализация Web Audio API на Rust
   - Предоставляет широкие возможности для обработки аудио

## Выводы для разработки tts-sync

Для создания библиотеки tts-sync на Rust, которая будет синхронизировать TTS с видео и субтитрами, можно использовать следующий подход:

1. Использовать OpenAI API для генерации VTT субтитров и TTS аудио
2. Использовать библиотеку для парсинга VTT файлов для извлечения тайминга субтитров
3. Использовать rubato для изменения темпа аудио, чтобы подстроить его под длительность видео
4. Использовать symphonia для работы с аудио файлами
5. Реализовать алгоритм синхронизации, который будет:
   - Анализировать тайминг субтитров
   - Разбивать аудио на сегменты, соответствующие субтитрам
   - Подстраивать темп каждого сегмента для соответствия таймингу субтитров
   - Объединять сегменты в финальный аудио файл

Этот подход позволит создать гибкую библиотеку, которая будет максимально точно синхронизировать TTS с видео и субтитрами.
